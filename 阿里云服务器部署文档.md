# é£Ÿåˆ»å¡è·¯é‡Œå°ç¨‹åº - é˜¿é‡Œäº‘æœåŠ¡å™¨éƒ¨ç½²æ–‡æ¡£

## ðŸ“‹ ç›®å½•
- [1. çŽ¯å¢ƒè¦æ±‚](#1-çŽ¯å¢ƒè¦æ±‚)
- [2. é˜¿é‡Œäº‘æœåŠ¡å™¨å‡†å¤‡](#2-é˜¿é‡Œäº‘æœåŠ¡å™¨å‡†å¤‡)
- [3. çŽ¯å¢ƒå®‰è£…é…ç½®](#3-çŽ¯å¢ƒå®‰è£…é…ç½®)
- [4. é¡¹ç›®éƒ¨ç½²](#4-é¡¹ç›®éƒ¨ç½²)
- [5. åŸŸåå’ŒSSLé…ç½®](#5-åŸŸåå’Œsslé…ç½®)
- [6. å°ç¨‹åºé…ç½®](#6-å°ç¨‹åºé…ç½®)
- [7. ç›‘æŽ§å’Œç»´æŠ¤](#7-ç›‘æŽ§å’Œç»´æŠ¤)
- [8. æ•…éšœæŽ’æŸ¥](#8-æ•…éšœæŽ’æŸ¥)

## 1. çŽ¯å¢ƒè¦æ±‚

### 1.1 æœåŠ¡å™¨é…ç½®å»ºè®®
- **æœ€ä½Žé…ç½®**ï¼š2æ ¸4Gï¼Œ40Gç³»ç»Ÿç›˜
- **æŽ¨èé…ç½®**ï¼š4æ ¸8Gï¼Œ80Gç³»ç»Ÿç›˜ + æ•°æ®ç›˜
- **æ“ä½œç³»ç»Ÿ**ï¼šCentOS 7.9/8.x æˆ– Alibaba Cloud Linux 3
- **ç½‘ç»œ**ï¼šå…¬ç½‘IP + å®‰å…¨ç»„é…ç½®

### 1.2 æŠ€æœ¯æ ˆç‰ˆæœ¬
- **Java**: OpenJDK 11
- **Docker**: 20.10+
- **Docker Compose**: 2.x
- **MySQL**: 8.0
- **Redis**: 6.0+
- **Nginx**: 1.20+
- **MinIO**: æœ€æ–°ç‰ˆ

## 2. é˜¿é‡Œäº‘æœåŠ¡å™¨å‡†å¤‡

### 2.1 è´­ä¹°ECSå®žä¾‹
```bash
# ç™»å½•é˜¿é‡Œäº‘æŽ§åˆ¶å°
# é€‰æ‹©ECSå®žä¾‹ â†’ åˆ›å»ºå®žä¾‹
# é…ç½®ï¼š
# - å®žä¾‹è§„æ ¼ï¼šecs.c6.large (2æ ¸4G) æˆ–æ›´é«˜
# - é•œåƒï¼šCentOS 7.9 64ä½
# - å­˜å‚¨ï¼š40GBé«˜æ•ˆäº‘ç›˜ + æ•°æ®ç›˜ï¼ˆå¯é€‰ï¼‰
# - ç½‘ç»œï¼šVPCç½‘ç»œï¼Œåˆ†é…å…¬ç½‘IP
# - å®‰å…¨ç»„ï¼šåˆ›å»ºæ–°çš„å®‰å…¨ç»„
```

### 2.2 å®‰å…¨ç»„é…ç½®
åœ¨é˜¿é‡Œäº‘æŽ§åˆ¶å°é…ç½®å®‰å…¨ç»„è§„åˆ™ï¼š

| è§„åˆ™æ–¹å‘ | æŽˆæƒç­–ç•¥ | åè®®ç±»åž‹ | ç«¯å£èŒƒå›´ | æŽˆæƒå¯¹è±¡ | æè¿° |
|---------|---------|---------|---------|---------|------|
| å…¥æ–¹å‘ | å…è®¸ | TCP | 22 | 0.0.0.0/0 | SSHè¿œç¨‹è¿žæŽ¥ |
| å…¥æ–¹å‘ | å…è®¸ | TCP | 80 | 0.0.0.0/0 | HTTPè®¿é—® |
| å…¥æ–¹å‘ | å…è®¸ | TCP | 443 | 0.0.0.0/0 | HTTPSè®¿é—® |
| å…¥æ–¹å‘ | å…è®¸ | TCP | 8080 | 0.0.0.0/0 | åŽç«¯APIæœåŠ¡ |
| å…¥æ–¹å‘ | å…è®¸ | TCP | 9000 | 0.0.0.0/0 | MinIOå­˜å‚¨æœåŠ¡ |

### 2.3 åŸŸåå‡†å¤‡ï¼ˆæŽ¨èï¼‰

#### 2.3.1 è´­ä¹°åŸŸå
**æ–¹æ³•1ï¼šåœ¨é˜¿é‡Œäº‘è´­ä¹°åŸŸå**
```bash
# 1. ç™»å½•é˜¿é‡Œäº‘æŽ§åˆ¶å° https://www.aliyun.com
# 2. æœç´¢"åŸŸåæ³¨å†Œ"æœåŠ¡
# 3. è¾“å…¥æ‚¨æƒ³è¦çš„åŸŸåï¼Œå¦‚ï¼šmycalorie.com
# 4. é€‰æ‹©åŸŸååŽç¼€ï¼ˆæŽ¨è .com .cn .netï¼‰
# 5. åŠ å…¥è´­ç‰©è½¦å¹¶å®Œæˆæ”¯ä»˜
```

**æ–¹æ³•2ï¼šå…¶ä»–åŸŸåæä¾›å•†**
- è…¾è®¯äº‘ã€åŽä¸ºäº‘ã€Godaddyã€Namecheapç­‰
- è´­ä¹°åŽéœ€è¦ä¿®æ”¹DNSè§£æžæœåŠ¡å™¨æŒ‡å‘é˜¿é‡Œäº‘

#### 2.3.2 åŸŸåå¤‡æ¡ˆï¼ˆä¸­å›½å¤§é™†æœåŠ¡å™¨å¿…é¡»ï¼‰
**å¤‡æ¡ˆæµç¨‹ï¼š**
```bash
# 1. ç™»å½•é˜¿é‡Œäº‘æŽ§åˆ¶å°
# 2. æœç´¢"ICPå¤‡æ¡ˆ"æœåŠ¡
# 3. å¡«å†™å¤‡æ¡ˆä¿¡æ¯ï¼š
#    - ä¸»ä½“ä¿¡æ¯ï¼šä¸ªäºº/ä¼ä¸šä¿¡æ¯
#    - ç½‘ç«™ä¿¡æ¯ï¼šç½‘ç«™åç§°ã€å†…å®¹æè¿°
#    - æœåŠ¡å™¨ä¿¡æ¯ï¼šé€‰æ‹©æ‚¨çš„ECSå®žä¾‹
# 4. ä¸Šä¼ èµ„æ–™ï¼šèº«ä»½è¯ã€è¥ä¸šæ‰§ç…§ç­‰
# 5. ç­‰å¾…å®¡æ ¸ï¼ˆé€šå¸¸7-20ä¸ªå·¥ä½œæ—¥ï¼‰
```

**å¤‡æ¡ˆæ³¨æ„äº‹é¡¹ï¼š**
- ä¸ªäººå¤‡æ¡ˆï¼šç½‘ç«™å†…å®¹ä¸èƒ½æ¶‰åŠå•†ä¸šæ€§è´¨
- ä¼ä¸šå¤‡æ¡ˆï¼šéœ€è¦è¥ä¸šæ‰§ç…§ç­‰ä¼ä¸šèµ„è´¨
- å¤‡æ¡ˆæœŸé—´åŸŸåæ— æ³•è®¿é—®ï¼Œå»ºè®®å…ˆç”¨IPåœ°å€è°ƒè¯•

#### 2.3.3 é…ç½®åŸŸåè§£æž

**æ–¹æ³•1ï¼šåœ¨Cloudflareä¸­é…ç½®ï¼ˆæŽ¨èï¼‰**
```bash
# 1. ç™»å½• https://dash.cloudflare.com
# 2. é€‰æ‹©æ‚¨çš„åŸŸå
# 3. ç‚¹å‡» "DNS" é€‰é¡¹å¡
# 4. æ·»åŠ ä»¥ä¸‹DNSè®°å½•ï¼š
```

| ç±»åž‹ | åç§° | å†…å®¹ | ä»£ç†çŠ¶æ€ | TTL | è¯´æ˜Ž |
|------|------|------|---------|-----|------|
| A | @ | æ‚¨çš„æœåŠ¡å™¨å…¬ç½‘IP | ðŸŸ  å·²ä»£ç† | è‡ªåŠ¨ | æ ¹åŸŸåè§£æžï¼Œå¦‚ï¼šexample.com |
| A | www | æ‚¨çš„æœåŠ¡å™¨å…¬ç½‘IP | ðŸŸ  å·²ä»£ç† | è‡ªåŠ¨ | wwwå­åŸŸåè§£æžï¼Œå¦‚ï¼šwww.example.com |
| A | api | æ‚¨çš„æœåŠ¡å™¨å…¬ç½‘IP | ðŸŸ  å·²ä»£ç† | è‡ªåŠ¨ | APIå­åŸŸåè§£æžï¼Œå¦‚ï¼šapi.example.com |
| CNAME | * | æ‚¨çš„åŸŸå.com | ðŸŸ  å·²ä»£ç† | è‡ªåŠ¨ | é€šé…ç¬¦è§£æžï¼Œå¤„ç†æ‰€æœ‰å…¶ä»–å­åŸŸå |

**DNSè®°å½•ç±»åž‹è¯¦è§£ï¼š**

**ðŸ”µ Aè®°å½•ï¼ˆAddress Recordï¼‰**
```bash
# Aè®°å½•å°†åŸŸåç›´æŽ¥æŒ‡å‘IPåœ°å€
# æ ¼å¼ï¼šåŸŸå â†’ IPåœ°å€
# ç¤ºä¾‹ï¼šexample.com â†’ 123.456.789.10

# @ ç¬¦å·å«ä¹‰ï¼š
# @ = æ ¹åŸŸåæœ¬èº«ï¼Œå³æ‚¨è´­ä¹°çš„ä¸»åŸŸå
# å¦‚æžœæ‚¨çš„åŸŸåæ˜¯ mycalorie.comï¼Œé‚£ä¹ˆ @ å°±ä»£è¡¨ mycalorie.com

# www å­åŸŸåï¼š
# ä¼ ç»Ÿä¸Šç½‘ç«™éƒ½æœ‰wwwå‰ç¼€ï¼Œå¦‚ www.google.com
# è¿™æ¡è®°å½•è®©ç”¨æˆ·å¯ä»¥é€šè¿‡ www.æ‚¨çš„åŸŸå.com è®¿é—®

# api å­åŸŸåï¼š
# ä¸“é—¨ç”¨äºŽAPIæŽ¥å£è®¿é—®ï¼Œå¦‚ api.æ‚¨çš„åŸŸå.com
# å¯ä»¥å°†APIå’Œä¸»ç«™åˆ†å¼€ï¼Œæ›´ä¸“ä¸š
```

**ðŸ”µ CNAMEè®°å½•ï¼ˆCanonical Name Recordï¼‰**
```bash
# CNAMEè®°å½•å°†åŸŸåæŒ‡å‘å¦ä¸€ä¸ªåŸŸå
# æ ¼å¼ï¼šå­åŸŸå â†’ ä¸»åŸŸå
# ç¤ºä¾‹ï¼šblog.example.com â†’ example.com

# * é€šé…ç¬¦å«ä¹‰ï¼š
# * = åŒ¹é…æ‰€æœ‰æœªå•ç‹¬è®¾ç½®çš„å­åŸŸå
# å¦‚ï¼šmobile.æ‚¨çš„åŸŸå.comã€admin.æ‚¨çš„åŸŸå.com ç­‰
# éƒ½ä¼šè‡ªåŠ¨æŒ‡å‘ä¸»åŸŸå
```

**ðŸ”µ ä»£ç†çŠ¶æ€è¯´æ˜Žï¼š**
```bash
# ðŸŸ  å·²ä»£ç†ï¼ˆProxiedï¼‰ï¼š
# - æµé‡ç»è¿‡CloudflareæœåŠ¡å™¨
# - èŽ·å¾—CDNåŠ é€Ÿã€SSLè¯ä¹¦ã€DDoSé˜²æŠ¤
# - éšè—çœŸå®žæœåŠ¡å™¨IP
# - æŽ¨èå¼€å¯

# ðŸŸ« ä»…DNSï¼ˆDNS Onlyï¼‰ï¼š
# - ç›´æŽ¥è§£æžåˆ°æ‚¨çš„æœåŠ¡å™¨IP
# - ä¸ç»è¿‡Cloudflareä»£ç†
# - å¤±åŽ»CDNå’Œå®‰å…¨é˜²æŠ¤åŠŸèƒ½
# - ä¸€èˆ¬ä¸æŽ¨è
```

**ðŸ”µ TTLï¼ˆTime To Liveï¼‰è¯´æ˜Žï¼š**
```bash
# TTL = ç¼“å­˜æ—¶é—´ï¼Œå•ä½ï¼šç§’
# è‡ªåŠ¨ = Cloudflareè‡ªåŠ¨ä¼˜åŒ–ï¼ˆé€šå¸¸300ç§’ï¼‰
# è¾ƒå°å€¼ï¼šDNSæ›´æ”¹ç”Ÿæ•ˆå¿«ï¼Œä½†å¢žåŠ DNSæŸ¥è¯¢è´Ÿè½½
# è¾ƒå¤§å€¼ï¼šå‡å°‘DNSæŸ¥è¯¢ï¼Œä½†æ›´æ”¹ç”Ÿæ•ˆæ…¢
```

**ðŸ”„ DNSè§£æžæµç¨‹å›¾ï¼š**
```bash
ç”¨æˆ·è®¿é—®ï¼šhttps://mycalorie.com
    â†“
1. æµè§ˆå™¨æŸ¥è¯¢DNSï¼šmycalorie.comçš„IPæ˜¯ä»€ä¹ˆï¼Ÿ
    â†“
2. DNSæœåŠ¡å™¨è¿”å›žï¼šCloudflareçš„IPï¼ˆå¦‚ï¼š104.21.x.xï¼‰
    â†“
3. æµè§ˆå™¨è¿žæŽ¥åˆ°CloudflareæœåŠ¡å™¨
    â†“
4. Cloudflareå¤„ç†SSLã€ç¼“å­˜ã€å®‰å…¨æ£€æŸ¥
    â†“
5. Cloudflareè½¬å‘è¯·æ±‚åˆ°æ‚¨çš„æœåŠ¡å™¨ï¼ˆ123.456.789.10:80ï¼‰
    â†“
6. æ‚¨çš„Nginxå¤„ç†è¯·æ±‚å¹¶è¿”å›žå“åº”
    â†“
7. Cloudflareä¼˜åŒ–å“åº”ï¼ˆåŽ‹ç¼©ã€ç¼“å­˜ï¼‰
    â†“
8. ç”¨æˆ·æ”¶åˆ°æœ€ç»ˆå“åº”
```

**ðŸŽ¯ ä¸ºä»€ä¹ˆéœ€è¦è¿™äº›DNSè®°å½•ï¼Ÿ**
```bash
# @ è®°å½•ï¼ˆæ ¹åŸŸåï¼‰
ç”¨é€”ï¼šç”¨æˆ·ç›´æŽ¥è¾“å…¥ mycalorie.com æ—¶è®¿é—®
é‡è¦æ€§ï¼šâ­â­â­â­â­ å¿…é¡»é…ç½®

# www è®°å½•
ç”¨é€”ï¼šç”¨æˆ·ä¹ æƒ¯è¾“å…¥ www.mycalorie.com
é‡è¦æ€§ï¼šâ­â­â­â­ å¼ºçƒˆå»ºè®®é…ç½®

# api è®°å½•  
ç”¨é€”ï¼šå°ç¨‹åºAPIè°ƒç”¨ï¼Œå¦‚ api.mycalorie.com/user/login
é‡è¦æ€§ï¼šâ­â­â­ å¯é€‰ï¼Œä¹Ÿå¯ä»¥ç”¨ä¸»åŸŸå+è·¯å¾„

# * é€šé…ç¬¦è®°å½•
ç”¨é€”ï¼šå¤„ç†å…¶ä»–æ‰€æœ‰å­åŸŸåï¼Œé¿å…404é”™è¯¯
é‡è¦æ€§ï¼šâ­â­ å¯é€‰ï¼Œä½†æœ‰åŠ©äºŽç”¨æˆ·ä½“éªŒ
```

**Cloudflareé…ç½®ä¼˜åŠ¿ï¼š**
- âœ… **å…è´¹SSLè¯ä¹¦**ï¼šè‡ªåŠ¨ç­¾å‘å’Œç»­æœŸ
- âœ… **CDNåŠ é€Ÿ**ï¼šå…¨çƒèŠ‚ç‚¹åŠ é€Ÿè®¿é—®
- âœ… **DDoSé˜²æŠ¤**ï¼šå…è´¹çš„å®‰å…¨é˜²æŠ¤
- âœ… **ç¼“å­˜ä¼˜åŒ–**ï¼šé™æ€èµ„æºç¼“å­˜

**æ–¹æ³•2ï¼šåœ¨é˜¿é‡Œäº‘DNSæŽ§åˆ¶å°é…ç½®**
```bash
# å¦‚æžœæ‚¨æ›´å–œæ¬¢ä½¿ç”¨é˜¿é‡Œäº‘DNS
# 1. ç™»å½•é˜¿é‡Œäº‘æŽ§åˆ¶å°
# 2. æœç´¢"äº‘è§£æžDNS"æœåŠ¡
# 3. ç‚¹å‡»æ‚¨çš„åŸŸåè¿›å…¥è§£æžè®¾ç½®
# 4. æ·»åŠ ä»¥ä¸‹è§£æžè®°å½•ï¼š
```

| è®°å½•ç±»åž‹ | ä¸»æœºè®°å½• | è§£æžè·¯çº¿ | è®°å½•å€¼ | TTL |
|---------|---------|---------|--------|-----|
| A | @ | é»˜è®¤ | æ‚¨çš„æœåŠ¡å™¨å…¬ç½‘IP | 600 |
| A | www | é»˜è®¤ | æ‚¨çš„æœåŠ¡å™¨å…¬ç½‘IP | 600 |
| A | api | é»˜è®¤ | æ‚¨çš„æœåŠ¡å™¨å…¬ç½‘IP | 600 |
| CNAME | * | é»˜è®¤ | @.æ‚¨çš„åŸŸå.com | 600 |

**å®žé™…é…ç½®ç¤ºä¾‹ï¼š**
```bash
# æ ¹æ®æ‚¨çš„å®žé™…é…ç½®ï¼š
# åŸŸåï¼š554297.xyz
# æœåŠ¡å™¨IPï¼š59.110.150.196

# é…ç½®åŽçš„è®¿é—®æ•ˆæžœï¼š
# https://554297.xyz        â†’ ä¸»ç«™ï¼ˆå°ç¨‹åºåŽå°ç®¡ç†ï¼‰
# https://www.554297.xyz    â†’ ä¸»ç«™ï¼ˆä¸Žä¸Šé¢ç›¸åŒï¼‰
# https://api.554297.xyz    â†’ APIæŽ¥å£æœåŠ¡ï¼ˆå¯é€‰ï¼‰
# https://admin.554297.xyz  â†’ é€šè¿‡é€šé…ç¬¦è§£æžåˆ°ä¸»ç«™
# https://mobile.554297.xyz â†’ é€šè¿‡é€šé…ç¬¦è§£æžåˆ°ä¸»ç«™
```

**å°ç¨‹åºä¸­çš„ä½¿ç”¨ï¼š**
```javascript
// åœ¨å°ç¨‹åºçš„ utils/constants.js ä¸­é…ç½®ï¼š
const API_BASE_URL = 'https://api.554297.xyz';        // APIä¸“ç”¨åŸŸå
// æˆ–è€…
const API_BASE_URL = 'https://554297.xyz/api';        // ä¸»åŸŸå+è·¯å¾„ï¼ˆæŽ¨èï¼‰

const MINIO_BASE_URL = 'https://554297.xyz/files';    // æ–‡ä»¶è®¿é—®åœ°å€
```

**å‘½ä»¤è¡ŒéªŒè¯è§£æžæ˜¯å¦ç”Ÿæ•ˆï¼š**
```bash
# åœ¨æœ¬åœ°æ‰§è¡Œä»¥ä¸‹å‘½ä»¤éªŒè¯
nslookup æ‚¨çš„åŸŸå.com
ping æ‚¨çš„åŸŸå.com

# å¦‚æžœè¿”å›žæ‚¨çš„æœåŠ¡å™¨IPï¼ˆæˆ–Cloudflare IPï¼‰ï¼Œè¯´æ˜Žè§£æžæˆåŠŸ
# æ³¨æ„ï¼šä½¿ç”¨Cloudflareä»£ç†æ—¶ï¼Œpingè¿”å›žçš„æ˜¯Cloudflareçš„IPï¼Œè¿™æ˜¯æ­£å¸¸çš„

# è¯¦ç»†éªŒè¯ç¤ºä¾‹ï¼š
nslookup mycalorie.com
# åº”è¯¥è¿”å›žç±»ä¼¼ï¼š104.21.x.xï¼ˆCloudflareçš„IPï¼‰

curl -I https://mycalorie.com/health
# åº”è¯¥è¿”å›žï¼šHTTP/2 200ï¼ˆè¡¨ç¤ºç½‘ç«™æ­£å¸¸ï¼‰
```

#### 2.3.4 ç”³è¯·SSLè¯ä¹¦

**æ–¹æ³•1ï¼šä½¿ç”¨Cloudflareå…è´¹SSLï¼ˆæœ€ç®€å•ï¼ŒæŽ¨èï¼‰**
```bash
# å¦‚æžœä½¿ç”¨Cloudflareä»£ç†ï¼ŒSSLè¯ä¹¦å®Œå…¨è‡ªåŠ¨åŒ–ï¼
# 1. ç™»å½• https://dash.cloudflare.com
# 2. é€‰æ‹©æ‚¨çš„åŸŸå
# 3. ç‚¹å‡» "SSL/TLS" é€‰é¡¹å¡
# 4. é€‰æ‹©åŠ å¯†æ¨¡å¼ï¼š
#    - çµæ´»ï¼šCloudflareåˆ°ç”¨æˆ·HTTPSï¼ŒCloudflareåˆ°æºæœåŠ¡å™¨HTTP
#    - å®Œå…¨ï¼šç«¯åˆ°ç«¯HTTPSï¼ˆæŽ¨èï¼‰
#    - å®Œå…¨ï¼ˆä¸¥æ ¼ï¼‰ï¼šéœ€è¦æœ‰æ•ˆçš„æºæœåŠ¡å™¨è¯ä¹¦
# 5. ç­‰å¾…å‡ åˆ†é’Ÿï¼ŒSSLè¯ä¹¦è‡ªåŠ¨ç”Ÿæ•ˆ

# æ³¨æ„ï¼šä½¿ç”¨Cloudflareä»£ç†æ—¶ï¼Œæ‚¨çš„æœåŠ¡å™¨ä¸éœ€è¦é…ç½®SSLè¯ä¹¦ï¼
# Cloudflareä¼šè‡ªåŠ¨å¤„ç†HTTPSåŠ å¯†
```

**æ–¹æ³•2ï¼šé˜¿é‡Œäº‘å…è´¹SSLè¯ä¹¦**
```bash
# å¦‚æžœä¸ä½¿ç”¨Cloudflareä»£ç†ï¼Œå¯ä»¥ç”³è¯·ä¼ ç»ŸSSLè¯ä¹¦
# 1. ç™»å½•é˜¿é‡Œäº‘æŽ§åˆ¶å°
# 2. æœç´¢"SSLè¯ä¹¦"æœåŠ¡
# 3. é€‰æ‹©"å…è´¹è¯ä¹¦" â†’ "ç«‹å³è´­ä¹°"
# 4. è´­ä¹°æ•°é‡é€‰æ‹©1ï¼Œç‚¹å‡»è´­ä¹°ï¼ˆå…è´¹ï¼‰
# 5. åœ¨SSLè¯ä¹¦æŽ§åˆ¶å°ç‚¹å‡»"è¯ä¹¦ç”³è¯·"
# 6. å¡«å†™åŸŸåä¿¡æ¯ï¼š
#    - è¯ä¹¦ç»‘å®šåŸŸåï¼šæ‚¨çš„åŸŸå.com
#    - åŸŸåéªŒè¯æ–¹å¼ï¼šé€‰æ‹©DNSéªŒè¯
# 7. æŒ‰æç¤ºåœ¨DNSä¸­æ·»åŠ éªŒè¯è®°å½•
# 8. ç­‰å¾…è¯ä¹¦ç­¾å‘ï¼ˆé€šå¸¸å‡ åˆ†é’Ÿåˆ°å‡ å°æ—¶ï¼‰
# 9. ä¸‹è½½è¯ä¹¦æ–‡ä»¶ï¼ˆNginxæ ¼å¼ï¼‰
```

**æ–¹æ³•3ï¼šLet's Encryptå…è´¹è¯ä¹¦**
```bash
# åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»¥ä¸‹å‘½ä»¤è‡ªåŠ¨ç”³è¯·
# è¿™ä¸ªæ–¹æ³•æ›´ç®€å•ï¼Œè¯ä¹¦ä¼šè‡ªåŠ¨ç»­æœŸ

# å®‰è£…acme.sh
curl https://get.acme.sh | sh
source ~/.bashrc

# è®¾ç½®Cloudflare DNS APIï¼ˆç”¨äºŽè‡ªåŠ¨éªŒè¯ï¼‰
export CF_Key="æ‚¨çš„Cloudflare Global API Key"
export CF_Email="æ‚¨çš„Cloudflareé‚®ç®±"

# ç”³è¯·è¯ä¹¦ï¼ˆDNSéªŒè¯æ–¹å¼ï¼‰
~/.acme.sh/acme.sh --issue --dns dns_cf -d æ‚¨çš„åŸŸå.com -d www.æ‚¨çš„åŸŸå.com

# æˆ–è€…ä½¿ç”¨webrootéªŒè¯æ–¹å¼ï¼ˆéœ€è¦å…ˆå¯åŠ¨nginxï¼‰
~/.acme.sh/acme.sh --issue -d æ‚¨çš„åŸŸå.com --webroot /opt/calorie-app/ssl
```

**èŽ·å–Cloudflare APIå¯†é’¥ï¼š**
```bash
# 1. ç™»å½• https://dash.cloudflare.com
# 2. ç‚¹å‡»å³ä¸Šè§’å¤´åƒ â†’ "æˆ‘çš„ä¸ªäººèµ„æ–™"
# 3. ç‚¹å‡» "APIä»¤ç‰Œ" é€‰é¡¹å¡
# 4. åœ¨ "Global API Key" éƒ¨åˆ†ç‚¹å‡» "æŸ¥çœ‹"
# 5. è®°å½•æ‚¨çš„é‚®ç®±å’ŒGlobal API Key
# æ³¨æ„ï¼šè¯·å¦¥å–„ä¿ç®¡å¯†é’¥ï¼Œä¸è¦æ³„éœ²
```

**Cloudflareé…ç½®å®Œæ•´æŒ‡å—ï¼š**
```bash
# 1. åŸŸåæ·»åŠ åˆ°Cloudflare
#    - ç™»å½•CloudflareæŽ§åˆ¶å°
#    - ç‚¹å‡» "æ·»åŠ ç«™ç‚¹"
#    - è¾“å…¥æ‚¨çš„åŸŸå
#    - é€‰æ‹©å…è´¹è®¡åˆ’
#    - ç­‰å¾…DNSæ‰«æå®Œæˆ

# 2. æ›´æ–°åŸŸåæœåŠ¡å™¨
#    - åœ¨åŸŸåæ³¨å†Œå•†å¤„ä¿®æ”¹DNSæœåŠ¡å™¨
#    - æ”¹ä¸ºCloudflareæä¾›çš„æœåŠ¡å™¨åœ°å€
#    - ç­‰å¾…DNSä¼ æ’­ï¼ˆæœ€å¤š24å°æ—¶ï¼‰

# 3. é…ç½®DNSè®°å½•ï¼ˆå¦‚ä¸Šè¡¨æ‰€ç¤ºï¼‰

# 4. é…ç½®SSL/TLS
#    - é€‰æ‹© "å®Œå…¨" åŠ å¯†æ¨¡å¼
#    - å¼€å¯ "å§‹ç»ˆä½¿ç”¨HTTPS"
#    - å¼€å¯ "è‡ªåŠ¨HTTPSé‡å†™"

# 5. æ€§èƒ½ä¼˜åŒ–ï¼ˆå¯é€‰ï¼‰
#    - å¼€å¯ "è‡ªåŠ¨ç¼©å°"
#    - é…ç½® "ç¼“å­˜è§„åˆ™"
#    - å¼€å¯ "BrotliåŽ‹ç¼©"
```

#### 2.3.5 éƒ¨ç½²SSLè¯ä¹¦
**ä¸‹è½½å¹¶éƒ¨ç½²è¯ä¹¦ï¼š**
```bash
# åˆ›å»ºSSLç›®å½•
mkdir -p /opt/calorie-app/ssl

# æ–¹æ³•1ï¼šå¦‚æžœä½¿ç”¨é˜¿é‡Œäº‘è¯ä¹¦
# 1. åœ¨SSLè¯ä¹¦æŽ§åˆ¶å°ä¸‹è½½Nginxæ ¼å¼è¯ä¹¦
# 2. è§£åŽ‹åŽå°†è¯ä¹¦æ–‡ä»¶ä¸Šä¼ åˆ°æœåŠ¡å™¨

scp certificate.crt root@æ‚¨çš„æœåŠ¡å™¨IP:/opt/calorie-app/ssl/
scp private.key root@æ‚¨çš„æœåŠ¡å™¨IP:/opt/calorie-app/ssl/

# æ–¹æ³•2ï¼šå¦‚æžœä½¿ç”¨acme.shç”³è¯·çš„è¯ä¹¦
~/.acme.sh/acme.sh --install-cert -d æ‚¨çš„åŸŸå.com \
  --key-file /opt/calorie-app/ssl/private.key \
  --fullchain-file /opt/calorie-app/ssl/fullchain.pem \
  --reloadcmd "systemctl reload nginx"

# è®¾ç½®è¯ä¹¦æ–‡ä»¶æƒé™
chmod 600 /opt/calorie-app/ssl/*
```

#### 2.3.6 éªŒè¯åŸŸåé…ç½®
**å®Œæˆæ‰€æœ‰é…ç½®åŽéªŒè¯ï¼š**
```bash
# 1. éªŒè¯åŸŸåè§£æž
nslookup æ‚¨çš„åŸŸå.com

# 2. éªŒè¯HTTPè®¿é—®ï¼ˆéƒ¨ç½²å®ŒæˆåŽï¼‰
curl http://æ‚¨çš„åŸŸå.com/health

# 3. éªŒè¯HTTPSè®¿é—®ï¼ˆé…ç½®SSLåŽï¼‰
curl https://æ‚¨çš„åŸŸå.com/health

# 4. æ£€æŸ¥SSLè¯ä¹¦æœ‰æ•ˆæ€§
openssl s_client -connect æ‚¨çš„åŸŸå.com:443 -servername æ‚¨çš„åŸŸå.com
```

**åŸŸåé…ç½®æ¸…å•ï¼š**
- [ ] åŸŸåè´­ä¹°å®Œæˆ
- [ ] å¤‡æ¡ˆç”³è¯·æäº¤ï¼ˆç­‰å¾…å®¡æ ¸ï¼‰
- [ ] DNSè§£æžé…ç½®å®Œæˆ
- [ ] SSLè¯ä¹¦ç”³è¯·å®Œæˆ
- [ ] è¯ä¹¦æ–‡ä»¶éƒ¨ç½²å®Œæˆ
- [ ] åŸŸåè®¿é—®æµ‹è¯•é€šè¿‡

## 3. çŽ¯å¢ƒå®‰è£…é…ç½®

### 3.1 è¿žæŽ¥æœåŠ¡å™¨
```bash
# ä½¿ç”¨SSHè¿žæŽ¥æœåŠ¡å™¨ï¼ˆæ‚¨çš„å®žé™…é…ç½®ï¼‰
ssh root@59.110.150.196

# æˆ–åœ¨Tabbyä¸­é…ç½®ï¼š
# ä¸»æœº: 59.110.150.196
# ç«¯å£: 22
# ç”¨æˆ·å: root

# é¦–æ¬¡ç™»å½•åŽæ›´æ–°ç³»ç»Ÿ
yum update -y
```

### 3.2 å®‰è£…Dockerå’ŒDocker Compose
```bash
# å®‰è£…Docker
curl -fsSL https://get.docker.com | bash

# å¯åŠ¨DockeræœåŠ¡
systemctl start docker
systemctl enable docker

# æ·»åŠ å½“å‰ç”¨æˆ·åˆ°dockerç»„ï¼ˆå¯é€‰ï¼‰
usermod -aG docker $USER

# å®‰è£…Docker Compose
curl -L "https://github.com/docker/compose/releases/latest/download/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
chmod +x /usr/local/bin/docker-compose

# éªŒè¯å®‰è£…
docker --version
docker-compose --version
```

### 3.3 é…ç½®Dockeré•œåƒåŠ é€Ÿ
```bash
# åˆ›å»ºDockeré…ç½®ç›®å½•
mkdir -p /etc/docker

# é…ç½®é˜¿é‡Œäº‘é•œåƒåŠ é€Ÿå™¨
cat > /etc/docker/daemon.json << EOF
{
  "registry-mirrors": [
    "https://mirror.ccs.tencentyun.com",
    "https://docker.mirrors.ustc.edu.cn",
    "https://registry.docker-cn.com"
  ],
  "log-driver": "json-file",
  "log-opts": {
    "max-size": "100m",
    "max-file": "3"
  }
}
EOF

# é‡å¯DockeræœåŠ¡
systemctl daemon-reload
systemctl restart docker
```

### 3.4 åˆ›å»ºé¡¹ç›®ç›®å½•ç»“æž„
```bash
# åˆ›å»ºé¡¹ç›®æ ¹ç›®å½•
mkdir -p /opt/calorie-app
cd /opt/calorie-app

# åˆ›å»ºå­ç›®å½•
mkdir -p {data/mysql,data/redis,data/minio,logs,uploads,ssl}

# è®¾ç½®ç›®å½•æƒé™
chmod 755 /opt/calorie-app
chmod -R 777 data logs uploads
```

## 4. é¡¹ç›®éƒ¨ç½²

### 4.1 ä¸Šä¼ é¡¹ç›®æ–‡ä»¶
```bash
# æ–¹æ³•1ï¼šä½¿ç”¨scpä¸Šä¼ ï¼ˆåœ¨æœ¬åœ°æ‰§è¡Œï¼‰
scp -r /Users/lijiahong/WeChatProjects/* root@59.110.150.196:/opt/calorie-app/

# æ–¹æ³•2ï¼šä½¿ç”¨Tabbyçš„SFTPåŠŸèƒ½
# 1. åœ¨Tabbyä¸­å³é”®é€‰æ‹©"æ‰“å¼€SFTP"
# 2. å°†æœ¬åœ°é¡¹ç›®æ–‡ä»¶å¤¹æ‹–æ‹½åˆ° /opt/calorie-app/ ç›®å½•

# æ–¹æ³•3ï¼šä½¿ç”¨gitå…‹éš†ï¼ˆå¦‚æžœæœ‰ä»“åº“ï¼‰
cd /opt/calorie-app
git clone https://your-repository-url.git .

# æ–¹æ³•4ï¼šåŽ‹ç¼©åŒ…ä¸Šä¼ 
# åœ¨æœ¬åœ°åŽ‹ç¼©é¡¹ç›®ï¼štar -czf calorie-project.tar.gz miniprogram-1/ houduan/
# ä¸Šä¼ å¹¶è§£åŽ‹ï¼štar -xzf calorie-project.tar.gz
```

### 4.2 åˆ›å»ºDocker Composeé…ç½®æ–‡ä»¶
```bash
cd /opt/calorie-app
cat > docker-compose.yml << 'EOF'
version: '3.8'

services:
  # MySQLæ•°æ®åº“
  mysql:
    image: mysql:8.0
    container_name: calorie-mysql
    restart: unless-stopped
    environment:
      MYSQL_ROOT_PASSWORD: CalorieRoot554297!
      MYSQL_DATABASE: calorie_tracker
      MYSQL_USER: calorie_user
      MYSQL_PASSWORD: CalorieUser554297!
      TZ: Asia/Shanghai
    ports:
      - "3306:3306"
    volumes:
      - ./data/mysql:/var/lib/mysql
      - ./houduan/houduan/src/main/resources/db:/docker-entrypoint-initdb.d
    command: --character-set-server=utf8mb4 --collation-server=utf8mb4_unicode_ci
    networks:
      - calorie-network

  # Redisç¼“å­˜
  redis:
    image: redis:6.2-alpine
    container_name: calorie-redis
    restart: unless-stopped
    environment:
      TZ: Asia/Shanghai
    ports:
      - "6379:6379"
    volumes:
      - ./data/redis:/data
    command: redis-server --appendonly yes --requirepass CalorieRedis554297!
    networks:
      - calorie-network

  # MinIOå¯¹è±¡å­˜å‚¨
  minio:
    image: minio/minio:latest
    container_name: calorie-minio
    restart: unless-stopped
    environment:
      MINIO_ROOT_USER: minioadmin
      MINIO_ROOT_PASSWORD: CalorieMinio554297!
      TZ: Asia/Shanghai
    ports:
      - "9000:9000"
      - "9090:9090"
    volumes:
      - ./data/minio:/data
    command: server /data --console-address ":9090"
    networks:
      - calorie-network

  # åŽç«¯åº”ç”¨
  calorie-backend:
    build: ./houduan/houduan
    container_name: calorie-backend
    restart: unless-stopped
    environment:
      SPRING_PROFILES_ACTIVE: prod
      SPRING_DATASOURCE_URL: jdbc:mysql://mysql:3306/calorie_tracker?useUnicode=true&characterEncoding=utf8&serverTimezone=Asia/Shanghai
      SPRING_DATASOURCE_USERNAME: calorie_user
      SPRING_DATASOURCE_PASSWORD: CalorieUser554297!
      SPRING_REDIS_HOST: redis
      SPRING_REDIS_PORT: 6379
      SPRING_REDIS_PASSWORD: CalorieRedis554297!
      MINIO_ENDPOINT: http://minio:9000
      MINIO_ACCESS_KEY: minioadmin
      MINIO_SECRET_KEY: CalorieMinio554297!
      MINIO_BUCKET_NAME: calorie-images
      MINIO_DOMAIN: https://554297.xyz/files
      TZ: Asia/Shanghai
    ports:
      - "8080:8080"
    volumes:
      - ./uploads:/app/uploads
      - ./logs:/var/log/calorie-tracker
    depends_on:
      - mysql
      - redis
      - minio
    networks:
      - calorie-network

  # Nginxåå‘ä»£ç†
  nginx:
    image: nginx:1.20-alpine
    container_name: calorie-nginx
    restart: unless-stopped
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./nginx/nginx.conf:/etc/nginx/nginx.conf:ro
      - ./nginx/conf.d:/etc/nginx/conf.d:ro
      - ./ssl:/etc/nginx/ssl:ro
      - ./logs/nginx:/var/log/nginx
    depends_on:
      - calorie-backend
      - minio
    networks:
      - calorie-network

networks:
  calorie-network:
    driver: bridge
EOF
```

### 4.3 é…ç½®çŽ¯å¢ƒå˜é‡
```bash
# åˆ›å»ºçŽ¯å¢ƒå˜é‡æ–‡ä»¶
cat > .env << 'EOF'
# æ•°æ®åº“é…ç½®
MYSQL_ROOT_PASSWORD=CalorieRoot554297!
MYSQL_PASSWORD=CalorieUser554297!

# Redisé…ç½®
REDIS_PASSWORD=CalorieRedis554297!

# MinIOé…ç½®
MINIO_PASSWORD=CalorieMinio554297!

# æœåŠ¡å™¨é…ç½®
SERVER_DOMAIN=554297.xyz
SERVER_IP=59.110.150.196
EOF

# è®¾ç½®æ–‡ä»¶æƒé™
chmod 600 .env
```

### 4.4 åˆå§‹åŒ–æ•°æ®åº“
```bash
# ç¡®ä¿æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬å­˜åœ¨
ls -la houduan/houduan/src/main/resources/db/

# å¦‚æžœæ²¡æœ‰åˆå§‹åŒ–è„šæœ¬ï¼Œåˆ›å»ºä¸€ä¸ªåŸºç¡€çš„
mkdir -p houduan/houduan/src/main/resources/db
cat > houduan/houduan/src/main/resources/db/init.sql << 'EOF'
-- åˆ›å»ºæ•°æ®åº“ï¼ˆå¦‚æžœä¸å­˜åœ¨ï¼‰
CREATE DATABASE IF NOT EXISTS calorie_tracker 
CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

USE calorie_tracker;

-- è¿™é‡Œæ”¾ç½®æ‚¨çš„æ•°æ®åº“è¡¨ç»“æž„SQL
-- è¯·æ ¹æ®æ‚¨çš„å®žé™…æ•°æ®åº“ç»“æž„å¡«å†™
EOF
```

### 4.5 æž„å»ºå’Œå¯åŠ¨æœåŠ¡
```bash
# æž„å»ºå¹¶å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker-compose up -d

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose ps

# æŸ¥çœ‹æœåŠ¡æ—¥å¿—
docker-compose logs -f

# å•ç‹¬æŸ¥çœ‹æŸä¸ªæœåŠ¡çš„æ—¥å¿—
docker-compose logs -f calorie-backend
```

### 4.6 éªŒè¯æœåŠ¡çŠ¶æ€
```bash
# æ£€æŸ¥å®¹å™¨è¿è¡ŒçŠ¶æ€
docker ps

# æµ‹è¯•æ•°æ®åº“è¿žæŽ¥
docker exec -it calorie-mysql mysql -u calorie_user -pCalorieUser554297! calorie_tracker

# æµ‹è¯•Redisè¿žæŽ¥
docker exec -it calorie-redis redis-cli -a CalorieRedis554297!

# æµ‹è¯•åŽç«¯API
curl http://localhost:8080/api/actuator/health

# æµ‹è¯•MinIO
curl http://localhost:9000/minio/health/live
```

## 5. åŸŸåå’ŒSSLé…ç½®

### 5.1 åŸŸåè§£æžé…ç½®
åœ¨åŸŸåæä¾›å•†å¤„é…ç½®Aè®°å½•ï¼š
```
ä¸»æœºè®°å½•ï¼š@ï¼ˆæˆ–wwwï¼‰
è®°å½•ç±»åž‹ï¼šA
è®°å½•å€¼ï¼šæ‚¨çš„æœåŠ¡å™¨å…¬ç½‘IP
TTLï¼š600
```

### 5.2 ç”³è¯·SSLè¯ä¹¦
```bash
# æ–¹æ³•1ï¼šä½¿ç”¨acme.shè‡ªåŠ¨ç”³è¯·Let's Encryptè¯ä¹¦
curl https://get.acme.sh | sh
source ~/.bashrc

# ç”³è¯·è¯ä¹¦
~/.acme.sh/acme.sh --issue -d your-domain.com --webroot /opt/calorie-app/ssl

# å®‰è£…è¯ä¹¦
~/.acme.sh/acme.sh --install-cert -d your-domain.com \
  --key-file /opt/calorie-app/ssl/private.key \
  --fullchain-file /opt/calorie-app/ssl/fullchain.pem \
  --reloadcmd "docker-compose -f /opt/calorie-app/docker-compose.yml restart nginx"
```

### 5.3 é…ç½®Nginx

**æ–¹æ³•1ï¼šä½¿ç”¨Cloudflareä»£ç†ï¼ˆæŽ¨èï¼Œæ— éœ€SSLé…ç½®ï¼‰**
```bash
# ä½¿ç”¨Cloudflareæ—¶ï¼Œåªéœ€è¦é…ç½®HTTPæœåŠ¡
# Cloudflareä¼šè‡ªåŠ¨å¤„ç†HTTPSåŠ å¯†
cat > nginx/conf.d/calorie-cloudflare.conf << 'EOF'
# ä¸»ç«™ç‚¹é…ç½®ï¼ˆHTTPå³å¯ï¼ŒCloudflareå¤„ç†HTTPSï¼‰
server {
    listen 80;
    server_name 554297.xyz www.554297.xyz;

    # èŽ·å–çœŸå®žIPï¼ˆCloudflareä»£ç†ï¼‰
    set_real_ip_from 173.245.48.0/20;
    set_real_ip_from 103.21.244.0/22;
    set_real_ip_from 103.22.200.0/22;
    set_real_ip_from 103.31.4.0/22;
    set_real_ip_from 141.101.64.0/18;
    set_real_ip_from 108.162.192.0/18;
    set_real_ip_from 190.93.240.0/20;
    set_real_ip_from 188.114.96.0/20;
    set_real_ip_from 197.234.240.0/22;
    set_real_ip_from 198.41.128.0/17;
    set_real_ip_from 162.158.0.0/15;
    set_real_ip_from 104.16.0.0/13;
    set_real_ip_from 104.24.0.0/14;
    set_real_ip_from 172.64.0.0/13;
    set_real_ip_from 131.0.72.0/22;
    real_ip_header CF-Connecting-IP;

    # å®¢æˆ·ç«¯æœ€å¤§ä¸Šä¼ å¤§å°
    client_max_body_size 20M;

    # APIæŽ¥å£ä»£ç†
    location /api/ {
        proxy_pass http://calorie-backend:8080;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        # Cloudflareç‰¹æ®Šå¤´
        proxy_set_header CF-Connecting-IP $http_cf_connecting_ip;
        proxy_set_header CF-Ray $http_cf_ray;
    }

    # MinIOæ–‡ä»¶è®¿é—®ä»£ç†
    location /files/ {
        proxy_pass http://calorie-minio:9000/calorie-images/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        # ç¼“å­˜é…ç½®ï¼ˆä¸ŽCloudflareé…åˆï¼‰
        expires 7d;
        add_header Cache-Control "public, immutable";
    }

    # å¥åº·æ£€æŸ¥
    location /health {
        access_log off;
        return 200 "healthy\n";
        add_header Content-Type text/plain;
    }
}
EOF
```

**æ–¹æ³•2ï¼šä¼ ç»ŸHTTPSé…ç½®ï¼ˆä¸ä½¿ç”¨Cloudflareä»£ç†ï¼‰**
```bash
# å¦‚æžœä¸ä½¿ç”¨Cloudflareä»£ç†ï¼Œéœ€è¦é…ç½®SSLè¯ä¹¦
cat > nginx/conf.d/calorie-https.conf << 'EOF'
# HTTPé‡å®šå‘åˆ°HTTPS
server {
    listen 80;
    server_name 554297.xyz www.554297.xyz;
    return 301 https://$server_name$request_uri;
}

# HTTPSä¸»ç«™ç‚¹
server {
    listen 443 ssl http2;
    server_name 554297.xyz www.554297.xyz;

    # SSLè¯ä¹¦é…ç½®
    ssl_certificate /etc/nginx/ssl/fullchain.pem;
    ssl_certificate_key /etc/nginx/ssl/private.key;
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers HIGH:!aNULL:!MD5;
    ssl_prefer_server_ciphers on;

    # å®‰å…¨å¤´
    add_header Strict-Transport-Security "max-age=31536000; includeSubDomains" always;
    add_header X-Frame-Options DENY always;
    add_header X-Content-Type-Options nosniff always;

    # å®¢æˆ·ç«¯æœ€å¤§ä¸Šä¼ å¤§å°
    client_max_body_size 20M;

    # APIæŽ¥å£ä»£ç†
    location /api/ {
        proxy_pass http://calorie-backend:8080;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # MinIOæ–‡ä»¶è®¿é—®ä»£ç†
    location /files/ {
        proxy_pass http://calorie-minio:9000/calorie-images/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        # ç¼“å­˜é…ç½®
        expires 7d;
        add_header Cache-Control "public, immutable";
    }

    # å¥åº·æ£€æŸ¥
    location /health {
        access_log off;
        return 200 "healthy\n";
        add_header Content-Type text/plain;
    }
}
EOF
```

**é‡å¯nginxæœåŠ¡ï¼š**
```bash
# é‡å¯nginxæœåŠ¡
docker-compose restart nginx

# éªŒè¯é…ç½®
docker exec calorie-nginx nginx -t
```

## 6. å°ç¨‹åºé…ç½®

### 6.1 æ›´æ–°å°ç¨‹åºåŽç«¯åœ°å€
ä¿®æ”¹å°ç¨‹åºé¡¹ç›®ä¸­çš„ `utils/constants.js`ï¼š
```javascript
// ç”Ÿäº§çŽ¯å¢ƒé…ç½®ï¼ˆå·²æ›´æ–°ä¸ºæ‚¨çš„åŸŸåï¼‰
const API_BASE_URL = 'https://554297.xyz/api';
const MINIO_BASE_URL = 'https://554297.xyz/files';

// å¯¼å‡ºé…ç½®
module.exports = {
  API_BASE_URL,
  MINIO_BASE_URL
};
```

### 6.2 å¾®ä¿¡å°ç¨‹åºåŽå°é…ç½®
åœ¨å¾®ä¿¡å…¬ä¼—å¹³å°å°ç¨‹åºåŽå°é…ç½®ï¼š

**å¼€å‘ â†’ å¼€å‘ç®¡ç† â†’ å¼€å‘è®¾ç½® â†’ æœåŠ¡å™¨åŸŸåï¼š**
- requeståˆæ³•åŸŸåï¼š`https://554297.xyz`
- uploadFileåˆæ³•åŸŸåï¼š`https://554297.xyz`
- downloadFileåˆæ³•åŸŸåï¼š`https://554297.xyz`

### 6.3 å°ç¨‹åºå‘å¸ƒ
1. ä½¿ç”¨å¾®ä¿¡å¼€å‘è€…å·¥å…·æ‰“å¼€å°ç¨‹åºé¡¹ç›®
2. ç‚¹å‡»"ä¸Šä¼ "æŒ‰é’®ï¼Œå¡«å†™ç‰ˆæœ¬å·å’Œé¡¹ç›®å¤‡æ³¨
3. ç™»å½•å¾®ä¿¡å…¬ä¼—å¹³å°ï¼Œæäº¤å®¡æ ¸
4. å®¡æ ¸é€šè¿‡åŽå‘å¸ƒä¸Šçº¿

## 7. ç›‘æŽ§å’Œç»´æŠ¤

### 7.1 ç³»ç»Ÿç›‘æŽ§è„šæœ¬
```bash
# åˆ›å»ºç›‘æŽ§è„šæœ¬
cat > /opt/calorie-app/monitor.sh << 'EOF'
#!/bin/bash

# æ£€æŸ¥æœåŠ¡çŠ¶æ€
check_service_status() {
    echo "=== æœåŠ¡çŠ¶æ€æ£€æŸ¥ ==="
    docker-compose -f /opt/calorie-app/docker-compose.yml ps
    echo ""
}

# æ£€æŸ¥ç£ç›˜ç©ºé—´
check_disk_space() {
    echo "=== ç£ç›˜ç©ºé—´æ£€æŸ¥ ==="
    df -h
    echo ""
}

# æ£€æŸ¥å†…å­˜ä½¿ç”¨
check_memory() {
    echo "=== å†…å­˜ä½¿ç”¨æ£€æŸ¥ ==="
    free -h
    echo ""
}

# æ£€æŸ¥æ—¥å¿—å¤§å°
check_log_size() {
    echo "=== æ—¥å¿—æ–‡ä»¶å¤§å° ==="
    du -sh /opt/calorie-app/logs/*
    echo ""
}

# ä¸»å‡½æ•°
main() {
    echo "$(date): å¼€å§‹ç³»ç»Ÿå¥åº·æ£€æŸ¥"
    check_service_status
    check_disk_space
    check_memory
    check_log_size
    echo "$(date): ç³»ç»Ÿå¥åº·æ£€æŸ¥å®Œæˆ"
}

main
EOF

chmod +x /opt/calorie-app/monitor.sh
```

### 7.2 å®šæ—¶ä»»åŠ¡è®¾ç½®
```bash
# æ·»åŠ å®šæ—¶ä»»åŠ¡
crontab -e

# æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š
# æ¯å°æ—¶æ‰§è¡Œä¸€æ¬¡å¥åº·æ£€æŸ¥
0 * * * * /opt/calorie-app/monitor.sh >> /var/log/calorie-monitor.log 2>&1

# æ¯å¤©å‡Œæ™¨3ç‚¹æ¸…ç†è¿‡æœŸæ—¥å¿—
0 3 * * * find /opt/calorie-app/logs -name "*.log" -mtime +7 -delete

# æ¯å‘¨æ—¥å‡Œæ™¨2ç‚¹é‡å¯æœåŠ¡ï¼ˆå¯é€‰ï¼‰
0 2 * * 0 cd /opt/calorie-app && docker-compose restart
```

### 7.3 å¤‡ä»½è„šæœ¬
```bash
# åˆ›å»ºå¤‡ä»½è„šæœ¬
cat > /opt/calorie-app/backup.sh << 'EOF'
#!/bin/bash

BACKUP_DIR="/opt/backups"
DATE=$(date +%Y%m%d_%H%M%S)

# åˆ›å»ºå¤‡ä»½ç›®å½•
mkdir -p $BACKUP_DIR

# å¤‡ä»½æ•°æ®åº“
echo "å¤‡ä»½æ•°æ®åº“..."
docker exec calorie-mysql mysqldump -u root -p${MYSQL_ROOT_PASSWORD} --all-databases > $BACKUP_DIR/mysql_backup_$DATE.sql

# å¤‡ä»½åº”ç”¨æ•°æ®
echo "å¤‡ä»½åº”ç”¨æ•°æ®..."
tar -czf $BACKUP_DIR/app_data_backup_$DATE.tar.gz -C /opt/calorie-app data uploads

# æ¸…ç†7å¤©å‰çš„å¤‡ä»½
find $BACKUP_DIR -name "*backup*" -mtime +7 -delete

echo "å¤‡ä»½å®Œæˆ: $BACKUP_DIR"
EOF

chmod +x /opt/calorie-app/backup.sh

# æ·»åŠ åˆ°å®šæ—¶ä»»åŠ¡ï¼ˆæ¯å¤©å‡Œæ™¨4ç‚¹å¤‡ä»½ï¼‰
echo "0 4 * * * /opt/calorie-app/backup.sh >> /var/log/backup.log 2>&1" | crontab -
```

## 8. æ•…éšœæŽ’æŸ¥

### 8.1 å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ

#### é—®é¢˜1ï¼šå®¹å™¨å¯åŠ¨å¤±è´¥
```bash
# æ£€æŸ¥å®¹å™¨æ—¥å¿—
docker-compose logs å®¹å™¨å

# æ£€æŸ¥ç«¯å£å ç”¨
netstat -tlnp | grep ç«¯å£å·

# é‡æ–°æž„å»ºå®¹å™¨
docker-compose down
docker-compose up -d --build
```

#### é—®é¢˜2ï¼šæ•°æ®åº“è¿žæŽ¥å¤±è´¥
```bash
# æ£€æŸ¥MySQLå®¹å™¨çŠ¶æ€
docker exec -it calorie-mysql mysql -u root -p

# æ£€æŸ¥ç½‘ç»œè¿žæŽ¥
docker exec -it calorie-backend ping mysql

# é‡ç½®æ•°æ®åº“å¯†ç 
docker exec -it calorie-mysql mysql -u root -p -e "ALTER USER 'calorie_user'@'%' IDENTIFIED BY 'new_password';"
```

#### é—®é¢˜3ï¼šæ–‡ä»¶ä¸Šä¼ å¤±è´¥
```bash
# æ£€æŸ¥MinIOçŠ¶æ€
curl http://localhost:9000/minio/health/live

# æ£€æŸ¥å­˜å‚¨ç©ºé—´
df -h

# æ£€æŸ¥æ–‡ä»¶æƒé™
ls -la /opt/calorie-app/uploads
```

#### é—®é¢˜4ï¼šSSLè¯ä¹¦é—®é¢˜
```bash
# æ£€æŸ¥è¯ä¹¦æœ‰æ•ˆæœŸ
openssl x509 -in /opt/calorie-app/ssl/fullchain.pem -text -noout | grep "Not After"

# é‡æ–°ç”³è¯·è¯ä¹¦
~/.acme.sh/acme.sh --renew -d your-domain.com --force

# æ£€æŸ¥nginxé…ç½®
docker exec calorie-nginx nginx -t
```

### 8.2 æ€§èƒ½ä¼˜åŒ–å»ºè®®

#### 8.2.1 æ•°æ®åº“ä¼˜åŒ–
```bash
# æ·»åŠ MySQLé…ç½®ä¼˜åŒ–
cat >> docker-compose.yml << 'EOF'
    command: >
      --character-set-server=utf8mb4
      --collation-server=utf8mb4_unicode_ci
      --innodb_buffer_pool_size=512M
      --innodb_log_file_size=256M
      --max_connections=500
      --query_cache_size=64M
EOF
```

#### 8.2.2 åº”ç”¨ä¼˜åŒ–
```bash
# è°ƒæ•´JVMå‚æ•°
export JAVA_OPTS="-Xms1g -Xmx2g -XX:+UseG1GC -XX:MaxGCPauseMillis=200"
```

#### 8.2.3 Nginxä¼˜åŒ–
```bash
# åœ¨nginx.confä¸­æ·»åŠ ä¼˜åŒ–é…ç½®
worker_processes auto;
worker_connections 2048;
keepalive_timeout 30;
gzip on;
gzip_comp_level 6;
```

## 9. å®‰å…¨åŠ å›º

### 9.1 é˜²ç«å¢™é…ç½®
```bash
# å¯ç”¨firewalld
systemctl start firewalld
systemctl enable firewalld

# é…ç½®é˜²ç«å¢™è§„åˆ™
firewall-cmd --permanent --add-port=80/tcp
firewall-cmd --permanent --add-port=443/tcp
firewall-cmd --permanent --add-port=22/tcp
firewall-cmd --reload
```

### 9.2 å®šæœŸæ›´æ–°
```bash
# åˆ›å»ºæ›´æ–°è„šæœ¬
cat > /opt/calorie-app/update.sh << 'EOF'
#!/bin/bash
echo "æ›´æ–°ç³»ç»ŸåŒ…..."
yum update -y

echo "æ›´æ–°Dockeré•œåƒ..."
cd /opt/calorie-app
docker-compose pull

echo "é‡å¯æœåŠ¡..."
docker-compose down
docker-compose up -d

echo "æ¸…ç†æ—§é•œåƒ..."
docker system prune -f
EOF

chmod +x /opt/calorie-app/update.sh
```

## 10. è”ç³»å’Œæ”¯æŒ

å¦‚åœ¨éƒ¨ç½²è¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š
1. æœåŠ¡å™¨é˜²ç«å¢™å’Œå®‰å…¨ç»„é…ç½®
2. åŸŸåè§£æžæ˜¯å¦æ­£ç¡®
3. SSLè¯ä¹¦æ˜¯å¦æœ‰æ•ˆ
4. å„æœåŠ¡æ˜¯å¦æ­£å¸¸å¯åŠ¨

**éƒ¨ç½²å®ŒæˆåŽï¼Œæ‚¨çš„å°ç¨‹åºæž¶æž„å°†åŒ…æ‹¬ï¼š**
- âœ… é«˜å¯ç”¨çš„å®¹å™¨åŒ–éƒ¨ç½²
- âœ… HTTPSå®‰å…¨ä¼ è¾“
- âœ… æ•°æ®åº“å’Œç¼“å­˜æœåŠ¡
- âœ… æ–‡ä»¶å­˜å‚¨æœåŠ¡
- âœ… åå‘ä»£ç†å’Œè´Ÿè½½å‡è¡¡
- âœ… è‡ªåŠ¨åŒ–ç›‘æŽ§å’Œå¤‡ä»½
- âœ… å®‰å…¨åŠ å›ºé…ç½®

ç¥æ‚¨éƒ¨ç½²é¡ºåˆ©ï¼ðŸŽ‰ 